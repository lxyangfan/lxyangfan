title: Paxos协议
date: 2018-06-03
tages:
- 分布式协议
- Paxos算法
-----

### 背景和分布式一致性问题描述

下面引用自[Paxos算法的wiki](https://zh.wikipedia.org/zh-cn/Paxos%E7%AE%97%E6%B3%95#.E5.AE.9E.E4.BE.8B):

>- 分布式系统中的节点通信存在两种模型：共享内存（Shared memory）和消息传递（Messages passing）。
>- 基于**消息传递**通信模型的分布式系统，不可避免的会发生以下错误：进程可能会慢、被杀死或者重启，消息可能会延迟、丢失、重复，在基础 Paxos 场景中，先不考虑可能出现消息篡改即拜占庭错误的情况。
>- Paxos 算法解决的问题是在一个可能发生上述异常的分布式系统中如何就某个值达成一致，保证不论发生以上任何异常，都不会破坏决议的一致性。
>> 一个典型的场景是，在一个分布式数据库系统中，如果各节点的初始状态一致，每个节点都执行相同的操作序列，那么他们最后能得到一个一致的状态。为保证每个节点执行相同的命令序列，需要在每一条指令上执行一个“一致性算法”以保证每个节点看到的指令一致。一个通用的一致性算法可以应用在许多场景中，是分布式计算中的重要问题。因此从20世纪80年代起对于一致性算法的研究就没有停止过。

总结一下，基于消息传递实现的分布式系统在实现一致性方面会有2方面的挑战：
- 分布式的进程可能会failed(终止、重启、阻塞)；
- 消息传递过程中会发生丢失、延迟、重复等问题；

Paxos协议是为了解决分布式环境下一致性问题提出的方案。

### Paxos协议要解决的问题

> 为描述 Paxos 算法，Lamport 虚拟了一个叫做 Paxos 的希腊城邦，这个岛按照议会民主制的政治模式制订法律，但是没有人愿意将自己的全部时间和精力放在这种事情上。所以无论是议员，议长或者传递纸条的服务员都不能承诺别人需要时一定会出现，也无法承诺批准决议或者传递消息的时间。但是这里假设没有拜占庭将军问题（Byzantine failure，即虽然有可能一个消息被传递了两次，但是绝对不会出现错误的消息）；只要等待足够的时间，消息就会被传到。另外，Paxos 岛上的议员是不会反对其他议员提出的决议的。 
>>对应于分布式系统，议员对应于各个节点，制定的法律对应于系统的状态。各个节点需要进入一个一致的状态，例如在独立 Cache 的对称多处理器系统中，各个处理器读内存的某个字节时，必须读到同样的一个值，否则系统就违背了一致性的要求。一致性要求对应于法律条文只能有一个版本。议员和服务员的不确定性对应于节点和消息传递通道的不可靠性。

Lamport 将分布式一致性问题用故事的形式描述：每个议员是一个分布式节点，议员可以提出议程和投票审批议程；当半数以上的投票通过，那么议程才被认为是通过；每个议员都可以提出议程，但只有一项被通过。